<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Dashboard - Autopass</title>
    <link rel="stylesheet" href="/src/assets/styles/colors.css" />
</head>

<body>
    <header>
        <h1>Agenda de Hoje</h1>
        <button onclick="logout()">Sair</button>
    </header>

    <section id="appointments">
        <!-- Lista de agendamentos será renderizada aqui -->
    </section>

    <script type="module">
        import { supabase } from '/src/scripts/supabaseClient.js';

        async function fetchAppointments() {
            const user = (await supabase.auth.getUser()).data.user;
            if (!user) return (window.location.href = '/src/app/views/login.html');

            const { data, error } = await supabase
                .from('appointments')
                .select('*')
                .eq('prestador_id', user.id)
                .order('horario', { ascending: true });

            const container = document.getElementById('appointments');
            if (error) {
                container.innerHTML = `<p>Erro ao carregar: ${error.message}</p>`;
            } else if (data.length === 0) {
                container.innerHTML = '<p>Sem agendamentos para hoje.</p>';
            } else {
                container.innerHTML = data
                    .map(appt => `<div><strong>${appt.cliente}</strong> às ${appt.horario}</div>`)
                    .join('');
            }
        }

        fetchAppointments();

        window.logout = async () => {
            await supabase.auth.signOut();
            window.location.href = '/src/app/views/login.html';
        };
    </script>
</body>

</html>